<!doctype html>
<html lang="en">

<head>
    <title id="title">Kumojin</title>
</head>

<body>

<h1>Events</h1>

<hr>

<h3>New event:</h3>
<form>
    <label for="name">Name:</label>
    <input id="name" type="text"/>

    <input id="add" type="button" value="Add" onclick="addItem()"/>
</form>

<br>
<hr>

<h3>Event List:</h3>
<ul>
</ul>
</body>

<script type="application/javascript">

    let urlBackend = "http://localhost:8080/items";

    function addItem()
    {
        let fieldName = document.querySelector('#name');

        const payload = {
            name: fieldName.value
        }

        const options = {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: {
                'Content-Type': 'application/json'
            }
        }

        fetch(urlBackend, options)
            .then(() =>
            {
                // if (response.status === 200)
                // {
                getAndDisplayList();

                // } else if (response.status === 400)
                // {
                //     alert("Incomplete event");
                //
                // } else if (response.status === 409)
                // {
                //     alert("Duplicate event");
                //
                // } else
                // {
                //     alert("Unknown error - " + response.status);
                // }
            })
            .catch((error) =>
            {
                alert("Cannot connect to the backend - " + error)
            });
    }

    function clearEvent()
    {
        let fieldName = document.querySelector('#name');
        fieldName.value = "";
    }

    function clearList()
    {
        document.querySelector('ul').innerHTML = "";
    }

    function displayItem(text)
    {
        var element = document.createElement('li');
        element.id = "item";
        element.textContent = text;

        document.querySelector('ul').appendChild(element);
    }

    function getAndDisplayList()
    {
        clearEvent();
        clearList();

        fetch(urlBackend)
            .then(response =>
            {
                return response.json();
            })
            .then(data =>
            {
                for (let item of data.items)
                {
                    displayItem(item);
                }
            })
            .catch((error) =>
            {
                alert("Cannot connect to the backend - " + error)
            });
    }

    getAndDisplayList();

</script>

</html>
