<!doctype html>
<html lang="en">

<head>
    <title id="title">Kumojin</title>
</head>

<body>
<h1>Hello world!</h1>
<ul>
</ul>
<form>
    <label for="name">Name:</label>
    <input id="name" type="text"/>

    <input id="add" type="button" value="Add" onclick="addItem()"/>
</form>
</body>

<script type="application/javascript">

    function addItem()
    {
        let fieldName = document.querySelector('#name');

        const payload = {
            name: fieldName.value
        }

        const options = {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: {
                'Content-Type': 'application/json'
            }
        }

        fetch("http://localhost:8080/items", options)
            .then(() =>
            {
                fieldName.value = "";
                getAndDisplayList();
            })
            .catch((error) =>
            {
                alert("Cannot connect to the backend - " + error)
            });
    }

    function clearList()
    {
        document.querySelector('ul').innerHTML = "";
    }

    function displayItem(text)
    {
        var element = document.createElement('li');
        element.id = "item";
        element.textContent = text;

        document.querySelector('ul').appendChild(element);
    }

    function getAndDisplayList()
    {
        clearList();

        fetch("http://localhost:8080/items")
            .then(response =>
            {
                return response.json();
            })
            .then(data =>
            {
                for (let item of data.items)
                {
                    displayItem(item);
                }
            })
            .catch((error) =>
            {
                alert("Cannot connect to the backend - " + error)
            });
    }

    getAndDisplayList();

</script>

</html>
