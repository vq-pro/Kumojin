<!doctype html>
<html lang="en">

<head>
    <title id="title">Kumojin</title>
</head>

<style>
    .div-error {
        color: red;
    }
</style>

<body>

<h1>Events</h1>

<hr>

<h3>New event:</h3>
<div id="error" class="div-error" hidden></div>
<br>

<form>
    <label for="name">Name:</label>
    <input id="name" type="text"/>

    <input id="add" type="button" value="Add" onclick="addItem()"/>
</form>

<br>
<hr>

<h3>Event List:</h3>
<ul id="list">
</ul>
</body>

<script type="application/javascript">

    // FIXME-1 Put functions in separate JS files

    let urlBackend = "http://localhost:8080/items";

    function addItem()
    {
        const payload = {
            name: getInputField('name')
        }

        const options = {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: {
                'Content-Type': 'application/json'
            }
        }

        fetch(urlBackend, options)
            .then((response) =>
            {
                if (response.status === 201)
                {
                    getAndDisplayList();

                } else if (response.status === 400)
                {
                    setError('Invalid item');

                } else if (response.status === 409)
                {
                    setError('Duplicate item');

                } else
                {
                    setError('Internal server error (' + response.status + ')')
                }
            })
    }

    function clearError()
    {
        hideField('error')
    }

    function clearEvent()
    {
        setInputField('name', '');
    }

    function clearList()
    {
        setField('list', '');
    }

    function displayItem(text)
    {
        var element = document.createElement('li');
        element.id = "item";
        element.textContent = text;

        document.querySelector('ul').appendChild(element);
    }

    function getAndDisplayList()
    {
        clearError();
        clearEvent();
        clearList();

        fetch(urlBackend)
            .then(response =>
            {
                return response.json();
            })
            .then(data =>
            {
                for (let item of data.items)
                {
                    displayItem(item);
                }
            })
            .catch((error) =>
            {
                alert("Cannot connect to the backend - " + error)
            });
    }

    function getInputField(id)
    {
        return document.querySelector('#' + id).value;
    }

    function hideField(id)
    {
        document.querySelector('#' + id).hidden = true;
    }

    function setError(error)
    {
        showField('error')
        setField('error', error);
    }

    function setField(id, value)
    {
        document.querySelector('#' + id).innerHTML = value;
    }

    function setInputField(id, value)
    {
        document.querySelector('#' + id).value = value;
    }

    function showField(id)
    {
        document.querySelector('#' + id).hidden = false;
    }

    getAndDisplayList();

</script>

</html>
